<!doctype html>
<html lang="en" style="height: 100%">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <link
      rel="icon"
      href="https://kovu.dog/favicon.webp"
      sizes="any"
      type="image/webp"
    />
    <title>üçå</title>
    <style>
      body {
        background-color: #000;
        margin: 0;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        position: relative;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, sans-serif;
        touch-action: manipulation;
        user-select: none;
        -webkit-user-select: none;
      }

      #particle-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        pointer-events: none;
        overflow: hidden;
      }

      #fade-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #000;
        z-index: 2;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.25s ease-out;
      }

      #sticker {
        height: 50%;
        cursor: pointer;
        user-select: none;
        -webkit-user-drag: none;
        -webkit-tap-highlight-color: transparent;
        z-index: 10;
        position: relative;
        transition: transform 0.2s ease-out;
        will-change: transform;
        touch-action: manipulation;
      }

      #sticker:hover {
        transform: scale(1.1);
      }

      .game-btn {
        position: absolute;
        z-index: 20;
        background-color: #2196f3;
        color: white;
        border: none;
        border-radius: 50px;
        padding: 12px 32px;
        min-height: 56px;
        font-size: 16px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1.25px;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        transition:
          transform 0.1s,
          background-color 0.2s;
        outline: none;
        touch-action: manipulation;
        white-space: nowrap;
      }

      .game-btn:hover {
        transform: scale(1.1);
      }

      .game-btn:active {
        background-color: #0d47a1;
        transform: scale(0.9);
      }

      #char-btn {
        bottom: 30px;
      }

      #char-btn:hover {
        transform: scale(1.1);
      }

      #menu-btn {
        top: 30px;
        left: 30px;
      }

      #version-btn {
        top: 30px;
        right: 30px;
        background-color: transparent;
        opacity: 0.5;
      }

      #version-btn:hover {
        opacity: 1;
      }

      #side-menu {
        position: fixed;
        top: 0;
        left: 0;
        width: 450px;
        height: 100%;
        background-color: #1a1a1a;
        z-index: 200;
        transform: translateX(-100%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
        display: flex;
        flex-direction: column;
        padding: 30px;
        box-sizing: border-box;
      }

      #side-menu.open {
        transform: translateX(0);
      }

      #menu-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 150;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
      }

      #menu-overlay.visible {
        opacity: 1;
        pointer-events: auto;
      }

      .menu-item {
        position: relative;
        width: 100%;
        margin-bottom: 30px;
        background-color: #333;
        text-align: center;
        display: block;
        max-width: 100% !important;
      }

      #menu-maymoo-btn {
        background-color: #795548;
        display: none;
      }

      #menu-maymoo-btn.active {
        background-color: #4e342e;
        border: 2px solid #fff;
      }

      #menu-close-btn {
        background-color: #f44336;
        width: auto !important;
      }

      #menu-close-btn.active {
        background-color: #c62828;
        border: 2px solid #fff;
      }

      .particle {
        position: absolute;
        pointer-events: none;
        user-select: none;
        display: none;
      }

      .particle.active {
        display: block;
      }

      @keyframes fall {
        from {
          transform: translateY(-100px);
        }

        to {
          transform: translateY(120vh);
        }
      }

      @keyframes shoot {
        from {
          transform: translate(-50%, -50%) rotate(0deg);
        }

        to {
          transform: translate(var(--tx), var(--ty)) rotate(360deg);
        }
      }

      .particle.banana-anim {
        top: 0;
        animation-name: fall;
        animation-timing-function: linear;
        animation-fill-mode: forwards;
      }

      .particle.poop-anim {
        top: 50%;
        left: 50%;
        animation-name: shoot;
        animation-timing-function: cubic-bezier(0.25, 1, 0.5, 1);
        animation-fill-mode: forwards;
      }

      @media (max-width: 600px) {
        #side-menu {
          width: 100%;
        }

        .game-btn {
          width: auto;
          max-width: 90%;
          white-space: normal;
          height: auto;
          font-size: clamp(13px, 5vw, 19px);
          line-height: 1.2;
          padding: 16px 24px;
        }
      }

      #char-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 100;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        touch-action: manipulation;
      }

      #char-overlay.visible {
        opacity: 1;
        pointer-events: auto;
      }

      .char-option {
        width: 25%;
        max-width: 200px;
        cursor: pointer;
        transition: transform 0.2s;
        border-radius: 10px;
        padding: 10px;
      }

      .char-option img {
        width: 100%;
        height: auto;
        display: block;
        pointer-events: none;
      }

      .char-option:hover {
        transform: scale(1.1);
      }

      .char-option:active {
        transform: scale(0.9);
      }
    </style>
  </head>
  <body oncontextmenu="return false;">
    <div id="particle-container"></div>
    <div id="fade-overlay"></div>
    <button id="menu-btn" class="game-btn" onclick="toggleMenu()">
      &#9776;
    </button>
    <img
      id="sticker"
      src="assets/images/kovu.webp"
      draggable="false"
      onclick="handleClick(event)"
    />
    <button id="char-btn" class="game-btn" onclick="openCharMenu()">
      Choose Your Character
    </button>
    <button
      id="version-btn"
      class="game-btn"
      onclick="
        unlockAudioContext();
        playSound('pushies', 1.0);
      "
    >
      26.5
    </button>
    <div id="menu-overlay" onclick="toggleMenu()"></div>
    <div id="side-menu">
      <button
        id="menu-close-btn"
        class="game-btn menu-item"
        onclick="toggleMenu()"
      >
        Close Menu
      </button>
      <button
        class="game-btn menu-item"
        onclick="
          toggleMenu();
          openCharMenu();
        "
      >
        Choose Your Character
      </button>
      <button
        id="menu-maymoo-btn"
        class="game-btn menu-item"
        onclick="toggleMaymooMode()"
      >
        Maymoo Mode: OFF
      </button>
    </div>
    <div id="char-overlay" onclick="closeCharMenu(event)">
      <div class="char-option" onclick="selectChar('assets/images/kovu.webp')">
        <img src="assets/images/kovu.webp" draggable="false" />
      </div>
      <div
        class="char-option"
        onclick="selectChar('assets/images/maymoo.webp')"
      >
        <img src="assets/images/maymoo.webp" draggable="false" />
      </div>
      <div class="char-option" onclick="selectChar('assets/images/nyx.webp')">
        <img src="assets/images/nyx.webp" draggable="false" />
      </div>
    </div>
    <script>
      const bananaSrc = "assets/images/banana.svg";
      const poopSrc = "assets/images/poop.svg";
      const audioFiles = {
        banana: "assets/sounds/banana.flac",
        flutter: "assets/sounds/flutter.flac",
        choose: "assets/sounds/choose.flac",
        menu: "assets/sounds/menu.flac",
        cheer: "assets/sounds/cheer.flac",
        start: "assets/sounds/start.flac",
        pushies: "assets/sounds/pushies.flac",
      };
      const imageFiles = [
        "assets/images/kovu.webp",
        "assets/images/maymoo.webp",
        "assets/images/nyx.webp",
        "assets/images/banana.svg",
        "assets/images/poop.svg",
      ];
      imageFiles.forEach((src) => {
        const img = new Image();
        img.src = src;
      });
      const config = {
        minSpawnRate: 10,
        maxAnimDuration: 5000,
        safetyMargin: 1.25,
        initialPoolSize: 100,
      };
      const MAX_POOL_SIZE = Math.ceil(
        (config.maxAnimDuration / config.minSpawnRate) * config.safetyMargin,
      );
      const silenceTrim = 1250;
      const baseRotationSpeed = 0.5;
      const fadeDuration = 250;
      let poolIndex = 0;
      let particlePool = [];
      let isMaymooMode = false;
      let isAnimating = false;
      let rainGenInterval = null;
      let fadeTimer = null;
      let stopTimer = null;
      let spawnRate = 100;
      let currentRotation = 0;
      let startRotation = 0;
      let targetRotation = 0;
      let startTime = 0;
      let endTime = 0;
      const sticker = document.getElementById("sticker");
      const particleContainer = document.getElementById("particle-container");
      const fadeOverlay = document.getElementById("fade-overlay");
      function initPool() {
        growPool(config.initialPoolSize);
      }
      function growPool(amount) {
        const targetSize = Math.min(
          MAX_POOL_SIZE,
          particlePool.length + amount,
        );
        const createCount = targetSize - particlePool.length;
        if (createCount <= 0) return;
        for (let i = 0; i < createCount; i++) {
          const img = document.createElement("img");
          img.className = "particle";
          img.draggable = false;
          particleContainer.appendChild(img);
          particlePool.push(img);
        }
      }
      initPool();
      function resetAllParticles() {
        particlePool.forEach((el) => {
          el.className = "particle";
          el.removeAttribute("style");
        });
      }
      function toggleMenu() {
        unlockAudioContext();
        const menu = document.getElementById("side-menu");
        const overlay = document.getElementById("menu-overlay");
        const isOpen = menu.classList.contains("open");
        if (isOpen) {
          menu.classList.remove("open");
          overlay.classList.remove("visible");
        } else {
          menu.classList.add("open");
          overlay.classList.add("visible");
        }
      }
      const konamiCode = [
        "ArrowUp",
        "ArrowUp",
        "ArrowDown",
        "ArrowDown",
        "ArrowLeft",
        "ArrowRight",
        "ArrowLeft",
        "ArrowRight",
        "b",
        "a",
      ];
      let konamiIndex = 0;
      document.addEventListener("keydown", (e) => {
        if (
          e.key.toLowerCase() === konamiCode[konamiIndex].toLowerCase() ||
          e.key === konamiCode[konamiIndex]
        ) {
          konamiIndex++;
          if (konamiIndex === konamiCode.length) {
            activateEasterEgg();
            konamiIndex = 0;
          }
        } else {
          konamiIndex = 0;
        }
      });
      function activateEasterEgg() {
        const btn = document.getElementById("menu-maymoo-btn");
        btn.style.display = "block";
        const menu = document.getElementById("side-menu");
        if (!menu.classList.contains("open")) {
          toggleMenu();
        }
        if (!isMaymooMode) toggleMaymooMode();
        unlockAudioContext();
        playSound("cheer", 1.0);
      }
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      const audioCtx = new AudioContext();
      const buffers = {};
      async function loadAudio(key, url) {
        try {
          const response = await fetch(url);
          const arrayBuffer = await response.arrayBuffer();
          const decodedBuffer = await audioCtx.decodeAudioData(arrayBuffer);
          buffers[key] = decodedBuffer;
        } catch (e) {
          console.error("Failed to load audio:", url, e);
        }
      }
      Object.keys(audioFiles).forEach((key) => loadAudio(key, audioFiles[key]));
      let activeSources = [];
      let chooseSource = null;
      let menuSource = null;
      function playSound(key, volume = 1.0, loop = false) {
        if (audioCtx.state === "suspended") audioCtx.resume();
        if (!buffers[key]) return null;
        const source = audioCtx.createBufferSource();
        source.buffer = buffers[key];
        source.loop = loop;
        const gainNode = audioCtx.createGain();
        gainNode.gain.value = volume;
        source.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        source.start(0);
        return { source, gainNode };
      }
      function unlockAudioContext() {
        if (audioCtx.state === "suspended") audioCtx.resume();
      }
      function toggleMaymooMode() {
        unlockAudioContext();
        playSound("start", 1.0);
        isMaymooMode = !isMaymooMode;
        const btn = document.getElementById("menu-maymoo-btn");
        if (isMaymooMode) {
          btn.innerText = "Maymoo Mode: ON";
          btn.classList.add("active");
        } else {
          btn.innerText = "Maymoo Mode: OFF";
          btn.classList.remove("active");
        }
      }
      function openCharMenu() {
        unlockAudioContext();
        stopMenuAudio();
        const v = playSound("choose", 1.0);
        const c = playSound("menu", 1.0, true);
        if (c) chooseSource = c.source;
        document.getElementById("char-overlay").classList.add("visible");
      }
      function stopMenuAudio() {
        if (chooseSource) {
          try {
            chooseSource.stop();
          } catch (e) {}
          chooseSource = null;
        }
        if (menuSource) {
          try {
            menuSource.stop();
          } catch (e) {}
          menuSource = null;
        }
      }
      function closeCharMenu(e) {
        if (e.target.id === "char-overlay") {
          document.getElementById("char-overlay").classList.remove("visible");
          stopMenuAudio();
          playSound("cheer", 1.0);
        }
      }
      function selectChar(filename) {
        stopMenuAudio();
        playSound("cheer", 1.0);
        sticker.src = filename;
        document.getElementById("char-overlay").classList.remove("visible");
      }
      function animate() {
        if (!isAnimating) return;
        const now = Date.now();
        if (now >= endTime) {
          isAnimating = false;
          sticker.style.transition = "none";
          sticker.style.transform = "";
          void sticker.offsetWidth;
          sticker.style.transition = "transform 0.2s ease-out";
          return;
        }
        const progress = (now - startTime) / (endTime - startTime);
        currentRotation =
          startRotation + (targetRotation - startRotation) * progress;
        updateTransform(currentRotation);
        requestAnimationFrame(animate);
      }
      function updateTransform(deg) {
        const normalizedAngle = deg % 360;
        const radians = normalizedAngle * (Math.PI / 360);
        const pulseFactor = Math.sin(radians);
        const scale = 1.1 + 0.3 * pulseFactor;
        sticker.style.transform = `scale(${scale}) rotate(${deg}deg)`;
      }
      function handleClick(e) {
        unlockAudioContext();
        fadeOverlay.style.transition = "none";
        fadeOverlay.style.opacity = "0";
        const now = Date.now();
        const audioKey = isMaymooMode ? "flutter" : "banana";
        let spinDuration = 1;
        if (buffers[audioKey]) spinDuration = buffers[audioKey].duration;
        const rawDurationMs = spinDuration * 1000;
        const effectiveDurationMs = Math.max(0, rawDurationMs - silenceTrim);
        const mainVolume = audioKey === "flutter" ? 2.0 : 1.0;
        const instance = playSound(audioKey, mainVolume);
        if (audioKey === "banana") playSound("flutter", 2.0);
        if (instance) {
          activeSources.unshift(instance);
          activeSources.forEach((item, index) => {
            const time = audioCtx.currentTime;
            const targetVol = audioKey === "flutter" ? 2.0 : 1.0;
            const modifier = [1.0, 0.75, 0.5, 0.25][index] || 0;
            item.gainNode.gain.setTargetAtTime(
              targetVol * modifier,
              time,
              0.01,
            );
          });
          instance.source.onended = function () {
            activeSources = activeSources.filter((item) => item !== instance);
          };
        }
        if (!isAnimating) currentRotation = 0;
        startRotation = currentRotation;
        startTime = now;
        endTime = now + effectiveDurationMs;
        const duration = endTime - startTime;
        const projectedRotation = startRotation + duration * baseRotationSpeed;
        targetRotation = Math.round(projectedRotation / 360) * 360;
        if (!isAnimating) {
          isAnimating = true;
          sticker.style.transition = "none";
          requestAnimationFrame(animate);
        }
        clearTimeout(fadeTimer);
        clearTimeout(stopTimer);
        spawnRate = Math.max(config.minSpawnRate, spawnRate - 15);
        const requiredParticles = Math.ceil(
          (config.maxAnimDuration / spawnRate) * config.safetyMargin,
        );
        if (requiredParticles > particlePool.length) {
          growPool(requiredParticles - particlePool.length);
        }
        startRainGeneration();
        const timeUntilFade = Math.max(0, effectiveDurationMs - fadeDuration);
        fadeTimer = setTimeout(() => {
          fadeOverlay.style.transition = `opacity ${fadeDuration / 1000}s ease-out`;
          fadeOverlay.style.opacity = "1";
        }, timeUntilFade);
        stopTimer = setTimeout(() => {
          stopRainGeneration();
          resetAllParticles();
        }, effectiveDurationMs);
      }
      function startRainGeneration() {
        if (rainGenInterval) clearInterval(rainGenInterval);
        rainGenInterval = setInterval(spawnFromPool, spawnRate);
      }
      function stopRainGeneration() {
        clearInterval(rainGenInterval);
        rainGenInterval = null;
        spawnRate = 100;
      }
      function spawnFromPool() {
        const el = particlePool[poolIndex];
        poolIndex = (poolIndex + 1) % particlePool.length;
        el.className = "particle";
        el.removeAttribute("style");
        void el.offsetWidth;
        if (isMaymooMode) {
          el.src = poopSrc;
          el.style.width = 30 + Math.random() * 50 + "px";
          const angle = Math.random() * Math.PI * 2;
          const distance =
            Math.max(window.innerWidth, window.innerHeight) * 0.8;
          const tx = Math.cos(angle) * distance;
          const ty = Math.sin(angle) * distance;
          el.style.setProperty("--tx", `${tx}px`);
          el.style.setProperty("--ty", `${ty}px`);
          el.style.animationDuration = 1 + Math.random() * 2 + "s";
          el.className = "particle active poop-anim";
        } else {
          el.src = bananaSrc;
          el.style.left = Math.random() * 100 + "vw";
          el.style.width = 30 + Math.random() * 50 + "px";
          el.style.animationDuration = 2 + Math.random() * 3 + "s";
          el.className = "particle active banana-anim";
        }
      }
    </script>
  </body>
</html>
